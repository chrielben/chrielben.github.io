---
title: "Finance Project Bank"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(xml2)
library(tidyverse)
library(rvest)
library(knitr)
library(kableExtra)
```

```{r cars, echo = FALSE}
#Create a list with all html project names
filelist = list.files(pattern = "project_*.*.html")
# create df to hold data
df = tibble(Project = character(length(filelist)),
            'Project Status' = character(length(filelist)),
            Priority = character(length(filelist)),
            'Required departments' = character(length(filelist)),
            'Expected cost' = character(length(filelist)),
            'Projected approved by' = character(length(filelist)),
            'Budget approved by' = character(length(filelist))
            )

for (i in 1:length(filelist)) {
  data = read_html(filelist[i])
  #fill the df
  df$Project[i] = xml_child(xml_child(xml_child(data, 2), 2), 3) %>% 
                                   html_text() %>% 
                                   str_remove_all(pattern = "\nArticle\\s[0-9]")
    
  df$`Required departments`[i] =  xml_child(xml_child(xml_child(data, 2), 2), 6) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
  
  df$`Project Status`[i] =        xml_child(xml_child(xml_child(data, 2), 2), 11) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
  
  df$Priority[i] =                xml_child(xml_child(xml_child(data, 2), 2), 9) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
  
  df$`Expected cost`[i] =         xml_child(xml_child(xml_child(data, 2), 2), 8) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
  
  df$`Projected approved by`[i] = xml_child(xml_child(xml_child(data, 2), 2), 7) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
  
  df$`Budget approved by`[i] =    xml_child(xml_child(xml_child(data, 2), 2), 10) %>% 
                                  html_text() %>% 
                                  str_remove_all(pattern = "\nArticle\\s[0-9]")
}
df %>%
  filter(df$`Project Status` != "Completed") %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

